@using ShoseShop.ViewModel
@model List<SanPhamHomeViewModel>

@{
    int state = (int)(ShoseShop.Data.ChiTietSanPham.TrangThaiEnum)Model.ElementAt(0).spct.TrangThai;
}
<style>
    /* Custom CSS for Product Slider */
    .product-card {
        position: relative; /* Required for absolute positioning of button */
        flex: 0 0 auto;
        width: 250px;
        height: 370px;
        margin-right: 20px;
    }

    .product-image {
        width: 100%;
        height: 250px;
        overflow: hidden;
    }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

    /* Button Style */
    .btn-primary {
        background-color: #ffffff;
        color: #252a2b; /* Text color */
        border-color: #ffffff;
    }

        .btn-primary:hover {
            background-color: #1b4ea0;
        }

    .view-details-btn {
        position: absolute;
        bottom: 10px; /* Adjust as needed */
        left: 50%;
        width: 100%;
        transform: translateX(-50%);
        display: none; /* Initially hidden */
        background-color: #ffffff;
        border: 1px solid grey;
        color: #252a2b; /* Text color */
    }

        .view-details-btn:hover {
            background-color: #1b4ea0;
            color: #ffffff; /* Text color on hover */
        }

    /* Show button on hover */
    .product-card:hover .view-details-btn {
        display: block;
    }

    .text-top-right {
        position: absolute;
        top: 10px;
        right: 10px;
        color: #fdd464; /* Adjust text color as needed */
    }

    #prevBtn,
    #nextBtn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        z-index: 1;
    }

    #prevBtn {
        left: 10px;
    }

    #nextBtn {
        right: 10px;
    }

    /* Hide scrollbar */
    #productSlider {
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none; /* IE and Edge */
    }

    .product-info {
        margin-bottom: 10px;
    }
</style>

<!-- start features Area -->
<section class="features-area section_gap">
    <div class="container">
        <div class="row features-inner">
            <!-- single features -->
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="single-features">
                    <div class="f-icon">
                        <img src="~/Content/img/features/f-icon1.png" alt="">
                    </div>
                    <h6>Miễn phí vận chuyển</h6>
                    <p>Miễn phí vận chuyển cho mọi đơn hàng</p>
                </div>
            </div>
            <!-- single features -->
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="single-features">
                    <div class="f-icon">
                        <img src="~/Content/img/features/f-icon2.png" alt="">
                    </div>
                    <h6>Chính sách hoàn trả</h6>
                    <p>Miễn phí vận chuyển cho mọi đơn hàng</p>
                </div>
            </div>
            <!-- single features -->
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="single-features">
                    <div class="f-icon">
                        <img src="~/Content/img/features/f-icon3.png" alt="">
                    </div>
                    <h6>Hỗ trợ 24/7</h6>
                    <p>Miễn phí vận chuyển cho mọi đơn hàng</p>
                </div>
            </div>
            <!-- single features -->
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="single-features">
                    <div class="f-icon">
                        <img src="~/Content/img/features/f-icon4.png" alt="">
                    </div>
                    <h6>Thanh toán an toàn</h6>
                    <p>Miễn phí vận chuyển cho mọi đơn hàng</p>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- end features Area -->

<section class="container position-relative mt-2">
    <h2 class="text-center">SẢN PHẨM HOT</h2>
    <div id="productSlider" class="row flex-row flex-nowrap overflow-auto">
        @foreach (var spHomeView in Model)
        {
            <div class="product-card">
                <div class="product-image">
                    <a href="@Url.Action("HienThiSanpham1", "SanPham",
                        new { masanpham = spHomeView.spct.MaSP, maspct = spHomeView.spct.MaChiTietSP })">
                        <img src="~/Content/img/@spHomeView.spct.MaSP/@spHomeView.spct.AnhDaiDien"
                             alt="@spHomeView.spct.MaSPNavigation.TenSanPham @spHomeView.spct.MaMauNavigation.TenMau">
                        <p class="text-top-right"><strong>HOT</strong></p>
                    </a>
                </div>
                <div class="product-info">
                    <h5 class="mt-2" style="text-align:left">
                        @spHomeView.spct.MaSPNavigation.TenSanPham @spHomeView.spct.MaMauNavigation.TenMau
                    </h5>
                    <h5 style="text-align:left;">
                        @spHomeView.spct.MaSPNavigation.GiaSanPham.ToString("#,##0")đ
                    </h5>
                </div>
                <a class="btn btn-primary view-details-btn"
                   href="@Url.Action("HienThiSanpham1", "SanPham",
                        new { masanpham = spHomeView.spct.MaSP, maspct = spHomeView.spct.MaChiTietSP })">
                    Xem chi tiết
                </a>
            </div>
        }
    </div>
    <!-- Navigation Buttons -->
    <button class="btn btn-primary" id="prevBtn">
        <i class="bi bi-chevron-left"></i>
    </button>
    <button class="btn btn-primary" id="nextBtn">
        <i class="bi bi-chevron-right"></i>
    </button>
</section>

<script>

    $(document).ready(function () {

        // Lấy các element cần thiết
        const productSlider_2 = document.getElementById('productSlider_2');
        const prevBtn_2 = document.getElementById('prevBtn_2');
        const nextBtn_2 = document.getElementById('nextBtn_2');
        const cardElement_2 = document.querySelector('.product-card_2');

        // BẮT BUỘC: Chỉ chạy script nếu tất cả các element cần thiết đều tồn tại
        if (productSlider_2 && prevBtn_2 && nextBtn_2 && cardElement_2) {

            let scrollPosition_2 = 0;
            let manualScroll_2 = false;

            // Thêm 20px (margin-right) vào chiều rộng của card để cuộn chính xác
            const cardWidth_2 = cardElement_2.offsetWidth + 20;

            const nextSlide_2 = () => {
                // Kiểm tra lại để tránh lỗi nếu slider bị ẩn đi
                if (productSlider_2.scrollWidth <= productSlider_2.clientWidth) return;

                if (scrollPosition_2 < productSlider_2.scrollWidth - productSlider_2.clientWidth) {
                    scrollPosition_2 += cardWidth_2;
                } else {
                    scrollPosition_2 = 0; // Quay về đầu nếu đã đến cuối
                }
                productSlider_2.scroll({ left: scrollPosition_2, behavior: 'smooth' });
            };

            prevBtn_2.addEventListener('click', () => {
                if (scrollPosition_2 > 0) {
                    scrollPosition_2 -= cardWidth_2;
                    productSlider_2.scroll({ left: scrollPosition_2, behavior: 'smooth' });
                }
            });

            nextBtn_2.addEventListener('click', () => {
                nextSlide_2();
            });

            // Tự động trượt
            setInterval(() => {
                if (!manualScroll_2) {
                    nextSlide_2();
                }
            }, 5000);

            // Xử lý khi người dùng tự cuộn
            productSlider_2.addEventListener('scroll', () => {
                scrollPosition_2 = productSlider_2.scrollLeft;
                manualScroll_2 = true;
                // Đặt lại cờ sau một khoảng thời gian ngắn
                setTimeout(() => {
                    manualScroll_2 = false;
                }, 200);
            });
        }
    });
</script>