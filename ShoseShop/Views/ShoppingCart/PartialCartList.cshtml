@using ShoseShop.ViewModel
@model List<ShoppingCartItem>

@{
    decimal TotalCost = 0;
}

<div class="table-responsive">
    @if (Model != null && Model.Any())
    {
        <table class="table">
            <thead>
                <tr>
                    <th scope="col"><h4>Các sản phẩm</h4></th>
                    <th scope="col" class="text-center"><h4>Số lượng</h4></th>
                    <th scope="col" class="text-center"><h4>Tổng chi phí</h4></th>
                    <th scope="col" class="text-center"></th>
                </tr>
            </thead>
            <tbody>
                @foreach (ShoppingCartItem cartItem in Model)
                {
                    <tr>
                        <td>
                            <div class="media">
                                <div class="d-flex">
                                    <a href="@Url.Action("HienThiSanpham", "SanPham", new { madongsanpham = cartItem.sanphamct.MaSP, masp = cartItem.sanphamct.MaChiTietSP })">
                                        <img class="imageProduct" src="@Url.Content("~/Content/img/" + cartItem.sanphamct.MaSP + "/" + cartItem.sanphamct.AnhDaiDien)" alt="Hinh Anh Giay">
                                    </a>
                                </div>
                                <div class="media-body">
                                    <a href="@Url.Action("HienThiSanpham", "SanPham", new { madongsanpham = cartItem.sanphamct.MaSP, masp = cartItem.sanphamct.MaChiTietSP })">
                                        <h4>Giày @cartItem.Name</h4>
                                    </a>
                                    <h5>Màu sắc: @cartItem.TenMau</h5>
                                    <h5>Kích thước: @cartItem.Size</h5>
                                </div>
                            </div>
                        </td>
                        <td class="text-center">
                            <div class="product_count">
                          
                                <a href="#" class="DecreaseOne btn btn-light btn-sm" data-masp="@cartItem.sanphamct.MaChiTietSP" data-size="@cartItem.Size">
                                    <i class="bi bi-dash" style="font-size:1.5em"></i>
                                </a>
                                <input disabled type="text" value="@cartItem.Quantity" title="Quantity" style="max-width:70px; font-size:larger; text-align:center;">
                                <a href="#" class="IncreaseOne btn btn-light btn-sm" data-masp="@cartItem.sanphamct.MaChiTietSP" data-size="@cartItem.Size">
                                    <i class="bi bi-plus" style="font-size:1.5em"></i>
                                </a>
                            </div>
                        </td>
                        <td class="text-center">
                            @{
                                decimal GiaNotSale = cartItem.GiaGoc * cartItem.Quantity;
                                decimal priceSale = (cartItem.GiaGoc - (cartItem.GiaGoc * cartItem.PhanTramGiam / 100)) * cartItem.Quantity;
                            }
                            @if (cartItem.PhanTramGiam > 1)
                            {
                                TotalCost += priceSale;
                                <h4>
                                    @priceSale.ToString("#,##0")₫<br />
                                    <span style="text-decoration:line-through;color:#cccccc">@GiaNotSale.ToString("#,##0")₫</span>
                                </h4>
                            }
                            else
                            {
                                TotalCost += GiaNotSale;
                                <h4>@GiaNotSale.ToString("#,##0")₫</h4>
                            }
                        </td>
                        <td class="text-center">
                            
                            <a href="#" class="btn btn-danger btn-sm Delete" data-masp="@cartItem.sanphamct.MaChiTietSP" data-size="@cartItem.Size">
                                <i class="fa fa-trash" style="font-size:1.8em"></i>
                            </a>
                        </td>
                    </tr>
                }

                <tr>
                    <td></td>
                    <td></td>
                    <td><h4>Tổng hóa đơn</h4></td>
                    <td><h4>@TotalCost.ToString("#,##0")₫</h4></td>
                </tr>

                <tr class="out_button_area">
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>
                        <div class="checkout_btn_inner d-flex align-items-center">
                         
                            @Html.ActionLink("Tiếp tục mua sắm", "SanPhamTheoLoai", "SanPham", new { idType = 0 }, new { @class = "gray_btn" })
                            @Html.ActionLink("Thanh toán", "ThanhToan", "PhieuMua", null, new { @class = "primary_btn" })
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    }
    else
    {
        <div class="text-center p-5">
            <h3>Giỏ hàng của bạn đang trống</h3>
            <p>Hãy quay lại và chọn cho mình những sản phẩm ưng ý nhé!</p>
            @Html.ActionLink("Bắt đầu mua sắm", "Index", "Home")
        </div>
    }
</div>

<script>
   
    $(function () {
        $('.DecreaseOne').click(function (e) {
            e.preventDefault(); 
            var masp = $(this).data('masp');
            var size = $(this).data('size');
            $.ajax({
                url: '@Url.Action("DecreaseOne", "ShoppingCart")',
                type: 'GET',
                data: { Masp: masp, size: size },
                success: function (response) {
                    $('#partialCart').html(response);
                }
            });
        });

        $('.IncreaseOne').click(function (e) {
            e.preventDefault();
            var masp = $(this).data('masp');
            var size = $(this).data('size');
            $.ajax({
                url: '@Url.Action("IncreaseOne", "ShoppingCart")',
                type: 'GET',
                data: { Masp: masp, size: size },
                success: function (response) {
                    $('#partialCart').html(response);
                }
            });
        });

        $('.Delete').click(function (e) {
            e.preventDefault();
            if (confirm("Xác nhận xóa sản phẩm khỏi giỏ hàng?")) {
                var masp = $(this).data('masp');
                var size = $(this).data('size');
                $.ajax({
                    url: '@Url.Action("Delete", "ShoppingCart")',
                    type: 'GET',
                    data: { Masp: masp, tenSize: size },
                    success: function (response) {
                        $('#partialCart').html(response);
                    }
                });
            }
        });
    });
</script>