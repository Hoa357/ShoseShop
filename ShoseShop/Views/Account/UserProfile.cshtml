@model ShoseShop.Data.KhachHang

@if (Model != null)
{
    <div class="col-lg-12">
        <div id="partialInfo">
          
            @{ Html.RenderPartial("PartialViewProfileInfo", Model); }
        </div>

        <button type="button" class="genric-btn info radius" id="openModalEdit" data-toggle="modal" data-target="#exampleModal">
            Sửa hồ sơ
        </button>

        <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Sửa hồ sơ</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        
                        @Html.AntiForgeryToken()

                        <div class="form-group">
                            <label for="tenkh">Tên đăng nhập</label>
                          
                            @Html.TextBoxFor(m => m.TenKhachHang, new { @class = "form-control", id = "tenkh" })
                            <span class="text-danger" id="hotenInput"></span>
                        </div>
                        <div class="form-group">
                            <label for="sdt">Số điện thoại</label>
                            @Html.TextBoxFor(m => m.Phone, new { @class = "form-control", id = "sdt" })
                            <span class="text-danger" id="PhoneInput"></span>
                        </div>
                        <div class="form-group">
                            <label for="gioitinh">Giới tính</label>
                            
                            @Html.DropDownListFor(m => m.GioiTinh, new List<SelectListItem>
                            {
                                new SelectListItem { Text = "Nam", Value = "true" },
                                new SelectListItem { Text = "Nữ", Value = "false" }
                            }, new { @class = "form-control", id = "gioitinh" })
                            <span class="text-danger" id="GenderInput"></span>
                        </div>
                        <div class="form-group">
                            <label for="ngaysinh">Ngày sinh</label>
                           
                            @Html.TextBoxFor(m => m.NgaySinh, "{0:yyyy-MM-dd}", new { @class = "form-control", id = "ngaysinh", type = "date" })
                            <span class="text-danger" id="BirthInput"></span>
                        </div>

                        <button type="button" class="genric-btn primary radius" id="updateButton">Cập nhật</button>
                        <button type="button" class="genric-btn default radius" data-dismiss="modal">Đóng</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            $('#openModalEdit').click(function () {
                $('#hotenInput').text("");
                $('#PhoneInput').text("");
                $('#GenderInput').text("");
                $('#BirthInput').text("");
            });

            $("#updateButton").click(function () {
                var check = true;
                var tenkhView = $('#tenkh').val();
                if (tenkhView == "") { $('#hotenInput').text("Vui lòng nhập họ tên"); check = false; }

                var sdtview = $('#sdt').val();
                if (sdtview == "") { $('#PhoneInput').text("Vui lòng nhập số điện thoại"); check = false; }

                var gioitinhview = $("#gioitinh").val(); 
                var ngaysinhview = $('#ngaysinh').val();
                if (ngaysinhview == "") { $('#BirthInput').text("Chọn ngày sinh bạn nha"); check = false; }

                if (check) {
                    /
                    var token = $('input[name="__RequestVerificationToken"]').val();

                    $.ajax({
                        url: '@Url.Action("ChangeProfileUpdate", "Account")', 
                        type: 'POST', 
                        data: {
                            __RequestVerificationToken: token,
                            tenkh: tenkhView,
                            sdt: sdtview,
                            gioitinh: gioitinhview,
                            ngaysinh: ngaysinhview
                        },
                        success: function (data) {
                            $('#partialInfo').html(data);
                            $('#exampleModal').modal('hide');
                        },
                        error: function() {
                            alert("Có lỗi xảy ra, không thể cập nhật thông tin.");
                        }
                    });
                }
            });
        });
    </script>
}
else
{
    <p class="text-danger">Không thể tải thông tin người dùng. Vui lòng đăng nhập lại.</p>
}